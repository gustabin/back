/**
 * 
 */
package ar.com.santanderrio.obp.servicios.pagos.dao;

import org.junit.Assert;
import org.junit.Test;
import org.mockito.Matchers;
import org.mockito.Mockito;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.support.AnnotationConfigContextLoader;

import ar.com.santanderrio.obp.base.dao.DAOException;
import ar.com.santanderrio.obp.base.iatx.entities.IatxException;
import ar.com.santanderrio.obp.iatx.IatxBaseDAOTest;
import ar.com.santanderrio.obp.iatx.IatxMatcher;
import ar.com.santanderrio.obp.servicios.pagos.dao.impl.PreFormalizacionPrestamoDAOImpl;
import ar.com.santanderrio.obp.servicios.pagos.entities.PreFormalizacion;
import ar.com.santanderrio.obp.servicios.tarjetas.entities.CuentaMock;

/**
 * The Class PreFormalizacionPrestamoDAOTest.
 *
 * @author florencia.n.martinez
 */
@ContextConfiguration(loader = AnnotationConfigContextLoader.class, classes = {
		PreFormalizacionPrestamoDAOTest.PreFormalizacionPrestamoDAOTestConfiguration.class })
public class PreFormalizacionPrestamoDAOTest extends IatxBaseDAOTest {

	/** The Constant SERVICIO_CNSPMOFORM. */
	private static final String SERVICIO_CNSPMOFORM = "CNSPMOFORM";

	/** The Constant VERSION_120. */
	private static final String VERSION_120 = "120";
	
	private static final String VERSION_140 = "140";

	/** The pre formalizacion prestamo DAO. */
	@Autowired
	private PreFormalizacionPrestamoDAOImpl preFormalizacionPrestamoDAO;

	/**
	 * The Class PreFormalizacionPrestamoDAOTestConfiguration.
	 */
	@Configuration
	public static class PreFormalizacionPrestamoDAOTestConfiguration {

		/**
		 * Pre formalizacion prestamo DAO.
		 *
		 * @return the pre formalizacion prestamo DAO
		 */
		@Bean
		public PreFormalizacionPrestamoDAO preFormalizacionPrestamoDAO() {
			return new PreFormalizacionPrestamoDAOImpl();
		}
	}

	/**
	 * Dada una cuenta, cuando se invoca "obtenerPreFormalizacion", obtengo el
	 * objeto PreFormalizacion OK.
	 *
	 * @throws IatxException
	 *             the iatx exception
	 * @throws DAOException
	 *             the DAO exception
	 */
	@Test
	public void dadaCuentaCuandoInvocaObtenerPreFormalizacionObtengoPreFormalizacionOK()
			throws IatxException, DAOException {
	//	String tramaResponse = "200000000000P04HTML0009900010302QLPO92  ********00593645000001272017041814335200000000IBF22624000000000000CNSPMOFORM1200000            02615492    00        00 014317668201704181433440000000000                            0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000DHõ0275000000000õACTEõ000õ0õ000000639170õACTEõ000õ0õ000000639170õ350023COAPQ  P00   350082004ARSN00722511        00722511007285500072062511õ00722511035000331403                                õ0000000õ2õ00000000600000000õ00000000600000000õ00000000600000000õ00000000600000000õ00000000600000000õ00000000000õ00000000000000000õ00000000380065800õ00000000000000000õ2017-03-162017-03-162017-03-162017-06-142017-06-142017-06-14õ0001-01-012017-09-142017-03-162017-06-142017-03-162017-06-14õ2017-06-140001-01-012017-06-149999-12-319999-12-312017-06-14õ0001-01-012017-09-142017-03-162017-06-142017-03-162017-03-162017-06-142017-03-16õ2017-03-160001-01-010001-01-01õ9999-12-319999-12-31õ0001-01-019999-12-310001-01-010001-01-010001-01-010001-01-019999-12-31õSN0N                N            õ0NNNISXENN0NNS0NN 0  NNNNVNNNHN NN NN0NNNSNNNN0õ00700063917000000072  ARS070001õ001    COMõ000õ000000000õNNNNõ00000000000000000õ0001-01-010001-01-019999-12-319999-12-310001-01-019999-12-319999-12-31õ0001-01-010001-01-010001-01-010001-01-019999-12-310001-01-019999-12-31õ007225119999-12-31õ2017-03-162017-03-160001-01-010001-01-0100000000õ00000000000000000õ00000000000000000õ00000000000000000õN  9999-12-31õ000õ00000õ   õ100000000õ00000õ000õ000õ037136652õ000000000õ000000000õ001õ00000000000000000õ9999-12-319999-12-31õ000õ    õ14õN 9999-12-31035992635707251100729999-12-31õ00700063917000000072  ARS2017-03-16õN9999-12-31õ00000000000000000õ000000000õ0001-01-01õ00000000000000000õ000õ00000000000000000õ00000000000000000õ0001-01-019999-12-31õ9999-12-319999-12-319999-12-31õ00000000000000000õ00000000000000000õ00000000000000000õ Sõ032000000õ    õ          õ         õ                  õ                  õ0001-01-01õ00000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000õ00000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ   õ00000000600000000õ00000000600000000õ00000000600000000õ00000000600000000õ00000000600000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000380065800õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ    õ    õ   õ õ  õ           õ                                                            õ        õ          õ          õ          õ    õ õ õ õ õ00000000000000000õ00000000000000000õ   õ          õ00000000000000000õ00000000000000000õ   õ          õ            õ    õ    õ   õ            õ    õ            õ";
		String tramaResponse ="200000000000P04HTML0009900010302FLND81  ********00129106000001352019022110535100000000IBF00CUR000000000000CNSPMOFORM1400000            02513381    00        00 000000000201902211053240000000000                            0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000DHõ0288400000000õACTEõ000õ0õ000003523294õACTEõ000õ0õ000003523294õ350027COAPQ  P00   350012003ARSN00722511        00722511007285540072702511õ00722511035000333119                                õ0000000õ2õ00000000010000000õ00000000010000000õ00000000010000000õ00000000010000000õ00000000010000000õ00000000000õ00000000000000000õ00000000006775400õ00000000000000000õ2018-03-202018-03-202018-03-202018-04-242018-04-242018-04-24õ0001-01-012018-06-242018-03-202018-04-242018-03-202018-04-24õ2018-04-240001-01-012018-04-249999-12-319999-12-312018-04-24õ0001-01-012018-06-242018-03-202018-04-242018-03-202018-03-202018-04-242018-03-20õ2018-03-200001-01-010001-01-01õ9999-12-319999-12-31õ0001-01-019999-12-310001-01-010001-01-010001-01-010001-01-019999-12-31õSN0N                N            õ0NNNISXENN0NNS0NN 0  NNNNVNNNHN NN NN0NNNSNNNN0õ00700352329400000072  ARS070001õ001    COMõ000õ000000000õNNNNõ00000000000000000õ0001-01-010001-01-019999-12-319999-12-310001-01-019999-12-319999-12-31õ0001-01-010001-01-010001-01-010001-01-019999-12-310001-01-019999-12-31õ007225119999-12-31õ2018-03-202018-03-200001-01-010001-01-0100000000õ00000000000000000õ00000000000000000õ00000000000000000õN  9999-12-31õ000õ00000õ   õ100000000õ00000õ000õ000õ046401294õ000000000õ000000000õ001õ00000000000000000õ9999-12-319999-12-31õ000õ    õ24õN 9999-12-31035992637956251100729999-12-31õ00700352329400000072  ARS2018-03-20õN9999-12-31õ00000000000000000õ000000000õ0001-01-01000000000000000000000000000000000000000000000000000000õ0001-01-019999-12-31õ9999-12-319999-12-319999-12-31õ00000000000000000õ00000000000000000õ00000000000000000õ Sõ038730000õ              õ         õ                  õ                  õ00722511035000333119õ0001-01-01õ00000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000õ00000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ   õ00000000010000000õ00000000010000000õ00000000010000000õ00000000010000000õ00000000010000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000006775400õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ00000000000000000õ    õ    õ   õ õ  õ           õ                                                            õ        õ          õ          õ          õ    õ õ õ õ õ00000000000000000õ00000000000000000õ   õ          õ00000000000000000õ00000000000000000õ   õ          õ            õ    õ    õ   õ            õ    õ    õ   õ101õ2018-03-20õ9999-12-31õFõ038730000õ   õ000000000õLQEõ000000000õ000000000õ    õ00000000000õ          õ00000000000000000õ";
		Mockito.when(iatxSender.send(Matchers.argThat(new IatxMatcher(SERVICIO_CNSPMOFORM, VERSION_140))))
				.thenReturn(tramaResponse);

		PreFormalizacion preformalizacion = preFormalizacionPrestamoDAO
				.obtenerPreFormalizacion(CuentaMock.completarInfoCuenta());

		Assert.assertNotNull(preformalizacion);
		Assert.assertEquals("35001", preformalizacion.getCodigoDestinoPrestamo());
		Assert.assertEquals("3", preformalizacion.getPlazo());
		Assert.assertEquals("2018-03-202018-03-202018-03-202018-04-242018-04-242018-04-24",
				preformalizacion.getPrestamoDebitoAdherido().getFechaInicio());
		Assert.assertEquals("00000000010000000", preformalizacion.getPrestamoDebitoAdherido().getMontoAPagar());
		Assert.assertEquals("000", preformalizacion.getPrestamoDebitoAdherido().getNroSucursal());
		Assert.assertEquals("000003523294", preformalizacion.getPrestamoDebitoAdherido().getNumero());
		Assert.assertEquals("0", preformalizacion.getPrestamoDebitoAdherido().getTipo());
	}
}